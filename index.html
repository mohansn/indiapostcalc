<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shipping Charges Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root { --bg:#f7f7fb; --card:#fff; --txt:#111; --primary:#1f6feb; --ok:#28a745; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--txt); }
    .container { max-width: 720px; margin: 0 auto; padding: 16px; }
    .card { background: var(--card); padding: 16px; border-radius: 12px; box-shadow: 0 4px 18px rgba(0,0,0,.06); }
    h1 { font-size: 1.35rem; margin: 0 0 8px; text-align:center; }
    p.sub { margin:0 0 16px; text-align:center; color:#555; font-size:.95rem; }
    label { display:block; margin-top:12px; font-weight:600; }
    select, input[type="text"], input[type="number"], button {
      width:100%; padding:12px; margin-top:6px; border-radius:10px; border:1px solid #dcdce0; font-size:1rem;
      background:#fff;
    }
    button { background: var(--primary); color:#fff; border:none; cursor:pointer; margin-top:18px; }
    button:hover { filter: brightness(0.95); }
    .row { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width:700px){ .row.two { grid-template-columns: 1fr 1fr; } }
    .result { margin-top:16px; padding:12px; border-left:4px solid var(--ok); background:#eaf7ee; border-radius:8px; font-weight:600; white-space:pre-wrap; }
    .hint { font-size:.85rem; color:#666; margin-top:6px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Shipping Charges Calculator</h1>
      <p class="sub">Rates + optional SAL/Air surcharge, then 18% tax</p>

      <label for="product">Product</label>
      <select id="product">
        <option value="letters">Letters</option>
        <option value="small_packets">Small Packets</option>
        <option value="printed_paper">Printed Paper</option>
        <option value="m_bag">M Bag</option>
        <option value="postcard">Airmail Post Card</option>
        <option value="aerogramme">Aerogramme</option>
      </select>

      <div class="row two">
        <div>
          <label for="country">Destination Country</label>
          <input list="countries" id="country" placeholder="Start typing..." />
          <datalist id="countries"></datalist>
          <div class="hint">UPU list (exclusions applied)</div>
        </div>
        <div>
          <label for="sector">Continent / Sector</label>
          <select id="sector">
            <option value="none">Not Applicable</option>
            <option value="asia">Asia</option>
            <option value="europe">Europe</option>
            <option value="africa">Africa</option>
            <option value="na_au">North America &amp; Australia</option>
            <option value="sa">South America</option>
          </select>
          <div class="hint">Auto-filled from country; you can override</div>
        </div>
      </div>

      <div class="row two">
        <div>
          <label for="mode">Delivery Mode</label>
          <select id="mode">
            <option value="normal">Normal (no surcharge)</option>
            <option value="sal">SAL (Surface Airlifted)</option>
            <option value="air">Air Mail</option>
          </select>
        </div>
        <div>
          <label for="weight">Weight (grams)</label>
          <input type="number" id="weight" min="1" placeholder="e.g. 250" />
        </div>
      </div>

      <button id="calcBtn">Calculate</button>

      <div id="result" class="result" style="display:none"></div>
      <div id="note" class="hint"></div>
    </div>
  </div>

<script>
/* -------------------------
   Countries (UPU minus exclusions) by region
   Sector mapping for surcharge categories:
   - asia, europe, africa, na_au (North America & Australia), sa (South America)
   ------------------------- */
const ASIA = [
  "Afghanistan","Armenia","Azerbaijan","Bahrain","Bangladesh","Bhutan","Brunei","Cambodia","China","Georgia",
  "India","Indonesia","Japan","Jordan","Kazakhstan","Kuwait","Kyrgyzstan","Lebanon","Malaysia","Maldives",
  "Mongolia","Myanmar","Nepal","Oman","Philippines","Qatar","Saudi Arabia","Singapore","South Korea",
  "Sri Lanka","Tajikistan","Thailand","Turkmenistan","United Arab Emirates","Uzbekistan","Vietnam","Taiwan"
];

const EUROPE = [
  "Albania","Austria","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Cyprus",
  "Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland",
  "Italy","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Moldova","Monaco","Montenegro",
  "Netherlands","North Macedonia","Norway","Poland","Portugal","Romania","Russia","San Marino","Serbia",
  "Slovakia","Slovenia","Spain","Sweden","Switzerland","Ukraine","United Kingdom","Vatican City"
];

const AFRICA = [
  "Algeria","Angola","Benin","Botswana","Burkina Faso","Burundi","Cameroon","Cape Verde","Central African Republic",
  "Chad","Comoros","Democratic Republic of the Congo","Republic of the Congo","Djibouti","Egypt","Equatorial Guinea",
  "Eritrea","Eswatini","Ethiopia","Gabon","Gambia","Ghana","Guinea","Ivory Coast","Kenya","Lesotho","Liberia",
  "Madagascar","Malawi","Mali","Mauritania","Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda",
  "Senegal","Seychelles","Sierra Leone","Somalia","South Africa","South Sudan","Tanzania","Togo","Tunisia","Uganda",
  "Zambia","Zimbabwe"
];

const NORTH_AMERICA = [
  "Bahamas","Canada","Costa Rica","Cuba","Dominica","Dominican Republic","El Salvador","Guatemala","Haiti",
  "Honduras","Mexico","Nicaragua","Panama","Trinidad and Tobago","United States","Aruba","Curaçao",
  "Sint Maarten","Caribbean Netherlands"
];

const SOUTH_AMERICA = [
  "Argentina","Bolivia","Brazil","Chile","Colombia","Ecuador","Guyana","Paraguay","Peru","Suriname","Uruguay","Venezuela"
];

const OCEANIA = [
  "Australia","New Zealand","Fiji","Kiribati","Nauru","Papua New Guinea","Samoa","Solomon Islands","Vanuatu"
];

// Build master list and datalist (sorted)
const COUNTRIES = [...new Set([
  ...ASIA, ...EUROPE, ...AFRICA, ...NORTH_AMERICA, ...SOUTH_AMERICA, ...OCEANIA
])].sort((a,b)=>a.localeCompare(b));

const datalist = document.getElementById('countries');
COUNTRIES.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c;
  datalist.appendChild(opt);
});

// Auto sector from country – you can still override manually
const sectorSelect = document.getElementById('sector');
document.getElementById('country').addEventListener('input', e => {
  const c = e.target.value.trim();
  sectorSelect.value = sectorForCountry(c);
});

function sectorForCountry(c) {
  if (ASIA.includes(c)) return 'asia';
  if (EUROPE.includes(c)) return 'europe';
  if (AFRICA.includes(c)) return 'africa';
  if (SOUTH_AMERICA.includes(c)) return 'sa';
  if (NORTH_AMERICA.includes(c) || OCEANIA.includes(c)) return 'na_au';
  return 'none';
}

// Helpers
const ceilDiv = (num, den) => Math.max(0, Math.ceil(num / den));

// Calculate button
document.getElementById('calcBtn').addEventListener('click', calculate);

function calculate() {
  const product = document.getElementById('product').value;
  const country = (document.getElementById('country').value || '').trim();
  const mode = document.getElementById('mode').value; // normal | sal | air
  const sector = document.getElementById('sector').value; // asia|europe|africa|na_au|sa|none
  const w = parseFloat(document.getElementById('weight').value);
  const resultEl = document.getElementById('result');
  const noteEl = document.getElementById('note');

  if (!country || !COUNTRIES.includes(country)) {
    alert("Please choose a valid destination country from the list.");
    return;
  }
  if (!(w > 0)) {
    alert("Please enter a valid weight in grams.");
    return;
  }

  // ---- Base rates ----
  let base = 0;
  const isUSA = (country === 'United States');

  if (product === 'letters') {
    // First 20 g, then each addl 20 g (up to 2000 g)
    base = (isUSA ? 32 : 25) + 22 * ceilDiv(w - 20, 20) * (isUSA ? 1 : 0) + 15 * ceilDiv(w - 20, 20) * (!isUSA ? 1 : 0);
  } else if (product === 'small_packets') {
    // USA: first 100 g 115; addl 100 g 105
    // Non-USA: first 100 g 80; addl 100 g 70  (corrected)
    if (isUSA) {
      base = 115 + 105 * ceilDiv(w - 100, 100);
    } else {
      base = 80 + 70 * ceilDiv(w - 100, 100);
    }
  } else if (product === 'printed_paper') {
    // Only USA rates were given; apply same to all unless you have non-USA figures
    base = 35 + 25 * ceilDiv(w - 20, 20);
  } else if (product === 'm_bag') {
    // Weight is in grams; <= 5 kg = 700; then each addl kg (or part) = 150 up to 30 kg
    if (w <= 5000) base = 700;
    else base = 700 + 150 * ceilDiv(w - 5000, 1000);
  } else if (product === 'postcard') {
    base = (['Pakistan','Nepal','Bangladesh','Bhutan'].includes(country)) ? 10 : 15;
  } else if (product === 'aerogramme') {
    base = 20;
  }

  // ---- Surcharge (based on Delivery Mode) ----
  const salRates = { asia:3, europe:4, africa:4, na_au:7, sa:9 };
  const airRates = { asia:4, europe:5, africa:5, na_au:8, sa:10 };

  let surcharge = 0;
  if (mode === 'sal') {
    surcharge = (salRates[sector] || 0) * ceilDiv(w, 20);
  } else if (mode === 'air') {
    surcharge = (airRates[sector] || 0) * ceilDiv(w, 20);
  }

  const beforeTax = base + surcharge;
  const total = beforeTax * 1.18;

  // Output
  resultEl.style.display = 'block';
  resultEl.textContent =
    `Base: ₹${base.toFixed(2)}\n` +
    `Surcharge (${mode.toUpperCase()}${mode==='normal'?' (none)':''}${mode!=='normal' && sector!=='none' ? ' • ' + prettySector(sector) : ''}): ₹${surcharge.toFixed(2)}\n` +
    `Subtotal: ₹${beforeTax.toFixed(2)}\n` +
    `Total (incl. 18% tax): ₹${total.toFixed(2)}`;

  // Notes / sanity checks
  let notes = [];
  if (['letters','small_packets','printed_paper'].includes(product) && w > 2000) {
    notes.push('Note: slab rates are specified up to 2000 g for this product.');
  }
  if ((mode==='sal' || mode==='air') && sector==='none') {
    notes.push('Tip: sector not recognized for this country — select a sector manually to apply surcharge.');
  }
  noteEl.textContent = notes.join(' ');
}

function prettySector(s) {
  return {asia:'Asia', europe:'Europe', africa:'Africa', na_au:'North America & Australia', sa:'South America'}[s] || '';
}
</script>
</body>
</html>
